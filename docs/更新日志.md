# 📝 更新日志

## 2025-11-29 更新

### ✨ 新增功能

#### 1. 自动标记邮件为已读

**问题：** 之前处理完邮件后，邮件仍然保持未读状态，导致下次运行时会重复处理相同的邮件。

**解决方案：** 
- 添加了 `mark_email_as_read()` 方法
- 邮件处理并发送回复后，自动将原邮件标记为已读
- 避免重复处理相同的邮件

**影响的文件：**
- `src/tools/QQEmailTools.py` - 添加标记已读功能
- `src/state.py` - Email 类添加 `imap_id` 字段
- `main.py` - 更新初始状态
- `main_continuous.py` - 更新初始状态
- `test_workflow.py` - 更新初始状态

**使用效果：**
```
处理邮件 → 生成回复 → 发送邮件 → ✓ 标记为已读
```

现在运行 `python main.py` 或 `python main_continuous.py` 时：
- ✅ 只处理未读邮件
- ✅ 处理完成后自动标记为已读
- ✅ 下次运行不会重复处理

---

#### 2. 持续监控模式

**新增文件：** `main_continuous.py`

**功能：**
- 每60秒自动检查一次邮箱
- 发现新邮件立即处理
- 持续运行直到手动停止（Ctrl+C）

**使用方法：**
```bash
python main_continuous.py
```

**适用场景：**
- 7x24小时自动化客服
- 需要快速响应的场景

---

#### 3. 运行模式说明文档

**新增文件：** `运行模式说明.md`

**内容：**
- 三种运行模式对比
- 详细使用说明
- 适用场景建议
- 重要提示和注意事项

---

### 🐛 Bug修复

#### 1. QQ邮箱发送邮件错误处理

**问题：** QQ邮箱SMTP返回 `(-1, b'\x00\x00\x00')` 被误认为错误。

**解决方案：** 
- 识别QQ邮箱的特殊响应
- 将其视为发送成功
- 统一成功提示信息

#### 2. 提示信息混乱

**问题：** 显示"正在创建草稿邮件"，但实际是直接发送。

**解决方案：** 
- 统一为"正在发送邮件回复"
- 删除重复的提示信息
- 提示信息更清晰准确

---

### 📚 文档更新

- ✅ 更新 `README.md` - 统一为中文
- ✅ 新增 `运行模式说明.md` - 运行模式详细说明
- ✅ 新增 `更新日志.md` - 本文档

---

## 使用建议

### 推荐配置

**企业客服场景：**
```bash
# 使用持续监控模式
python main_continuous.py

# 建议检查间隔：30-60秒
```

**个人使用场景：**
```bash
# 使用单次运行模式
python main.py

# 配合系统定时任务，每小时运行一次
```

**开发测试场景：**
```bash
# 使用API服务模式
python deploy_api.py

# 通过 Web 界面手动触发
```

---

## 下一步计划

- [ ] 添加邮件处理日志记录
- [ ] 支持自定义邮件分类规则
- [ ] 添加邮件模板管理
- [ ] 支持多邮箱账号
- [ ] 添加Web管理界面

---

**更新时间：** 2025-11-29

