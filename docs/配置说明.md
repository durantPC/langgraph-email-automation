# 项目配置说明

> 📋 **文档导航**: [返回文档索引](README.md) | [快速开始](快速开始.md) | [硅基流动配置](硅基流动配置指南.md)

本项目已将原来的 Google Gemini 和 Groq 模型替换为国内的智谱AI模型，并将 Gmail API 替换为 QQ 邮箱。

## 环境变量配置

在项目根目录创建 `.env` 文件，添加以下配置：

```env
# QQ邮箱配置
MY_EMAIL=your_email@qq.com
QQ_EMAIL_AUTH_CODE=your_qq_email_auth_code

# 硅基流动API配置
SILICONFLOW_API_KEY=your_siliconflow_api_key
```

## 详细配置步骤

### 1. QQ邮箱配置

#### 1.1 获取QQ邮箱授权码

1. 登录 [QQ邮箱网页版](https://mail.qq.com/)
2. 点击顶部的"设置"
3. 选择"账户"选项卡
4. 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"部分
5. 开启"IMAP/SMTP服务"（如果尚未开启）
6. 点击"生成授权码"
7. 按照提示完成验证（可能需要发送短信）
8. 保存生成的授权码（这就是 `QQ_EMAIL_AUTH_CODE`）

**注意：** 
- 授权码不是你的QQ密码！
- 请妥善保管授权码，不要泄露
- 如果忘记授权码，可以重新生成

#### 1.2 配置示例

```env
MY_EMAIL=123456789@qq.com
QQ_EMAIL_AUTH_CODE=abcdefghijklmnop
```

### 2. 硅基流动API配置

#### 2.1 获取硅基流动API密钥

1. 访问 [硅基流动平台](https://siliconflow.cn/)
2. 注册并登录账号
3. 进入"控制台"或"API管理"
4. 找到"API密钥"或"创建密钥"
5. 点击"创建新的API Key"
6. 复制生成的API密钥（这就是 `SILICONFLOW_API_KEY`）

**注意：**
- 新注册用户通常会有免费额度
- 请查看硅基流动的定价政策
- API密钥请妥善保管

#### 2.2 配置示例

```env
SILICONFLOW_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 3. 使用的模型

项目中使用了以下硅基流动上的模型：

- **LLM模型**: `Qwen/Qwen2-VL-7B-Instruct` - 通义千问视觉语言模型，用于文本生成和对话
- **嵌入模型**: `BAAI/bge-large-zh-v1.5` - 中文嵌入模型，用于向量化文档

## 技术架构变更

### 原始架构
- LLM: Groq (Llama 3.3-70b)
- 嵌入: Google Gemini (text-embedding-004)
- 邮箱: Gmail API

### 新架构
- LLM: 硅基流动 (Qwen/Qwen2-VL-7B-Instruct)
- 嵌入: 硅基流动 (BAAI/bge-large-zh-v1.5)
- 邮箱: QQ邮箱 (SMTP/IMAP)

## 依赖变更

### 移除的依赖
```
langchain-groq
langchain_google_genai
google-api-python-client
google-auth-oauthlib
google-auth-httplib2
```

### 使用的依赖
```
langchain_community  # 包含智谱AI集成
```

## QQ邮箱服务器信息

项目中使用的QQ邮箱服务器配置：

- **SMTP服务器**: smtp.qq.com
- **SMTP端口**: 465 (SSL)
- **IMAP服务器**: imap.qq.com
- **IMAP端口**: 993 (SSL)

## 常见问题

### Q1: QQ邮箱连接失败？
**A:** 请确保：
1. 已开启IMAP/SMTP服务
2. 使用的是授权码，不是QQ密码
3. 网络连接正常
4. 防火墙没有拦截相关端口

### Q2: 硅基流动API调用失败？
**A:** 请检查：
1. API密钥是否正确
2. 是否有足够的额度
3. 网络是否能访问硅基流动服务
4. 模型名称是否正确

### Q3: 如何测试配置是否正确？
**A:** 可以先运行 `create_index.py` 测试向量化和RAG功能：
```bash
python create_index.py
```

### Q4: 支持其他邮箱吗？
**A:** 理论上支持所有提供SMTP/IMAP服务的邮箱，只需修改 `src/tools/QQEmailTools.py` 中的服务器配置即可。

## 运行项目

配置完成后，按照以下步骤运行：

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 创建向量数据库（首次运行）
python create_index.py

# 3. 运行主程序
python main.py

# 4. 或部署为API（可选）
python deploy_api.py
```

## 支持

如有问题，请参考：
- [硅基流动文档](https://docs.siliconflow.cn/)
- [QQ邮箱帮助中心](https://service.mail.qq.com/)
- 项目 GitHub Issues

