# 🚀 硅基流动API配置指南

> 📋 **文档导航**: [返回文档索引](README.md) | [配置说明](配置说明.md) | [模型选择](模型选择说明.md)

项目已成功切换到硅基流动平台，使用 **Qwen2-VL-7B-Instruct** 模型。

---

## 📋 配置步骤

### 1️⃣ 获取硅基流动API密钥

#### 注册并获取密钥

1. 访问 **[硅基流动官网](https://siliconflow.cn/)**
2. 点击右上角 **"注册"** 或 **"登录"**
3. 完成注册后，进入 **控制台**
4. 在左侧菜单找到 **"API密钥"** 或 **"密钥管理"**
5. 点击 **"创建API密钥"**
6. 复制生成的密钥（格式类似：`sk-xxxxxxxxxxxxxxxx`）

**💡 提示：**
- 新用户通常有免费额度
- 密钥只显示一次，请妥善保存
- 可以创建多个密钥用于不同项目

---

### 2️⃣ 配置环境变量

在项目根目录创建 `.env` 文件：

```env
# QQ邮箱配置
MY_EMAIL=your_email@qq.com
QQ_EMAIL_AUTH_CODE=your_qq_email_auth_code

# 硅基流动API配置
SILICONFLOW_API_KEY=sk-your-api-key-here
```

**示例：**
```env
MY_EMAIL=123456789@qq.com
QQ_EMAIL_AUTH_CODE=abcdefghijklmnop
SILICONFLOW_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

### 3️⃣ 安装依赖

```bash
# 使用国内镜像加速安装
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

### 4️⃣ 重新创建向量数据库

⚠️ **重要：** 由于更换了嵌入模型，必须重新创建向量数据库！

```bash
# 删除旧数据库
rmdir /s /q db       # Windows
# rm -rf db/          # Linux/Mac

# 创建新数据库
python create_index.py
```

**预期输出：**
```
Loading & Chunking Docs...
Creating vector embeddings...
Test RAG chain...
Question: What are your pricing options?
Answer: [从文档中检索到的回答]
```

---

### 5️⃣ 运行项目

```bash
python main.py
```

---

## 🎯 使用的模型

### 主要LLM模型
- **模型名称**: `Qwen/Qwen2-VL-7B-Instruct`
- **提供商**: 阿里云通义千问
- **特点**: 
  - 视觉-语言多模态模型
  - 70亿参数，速度快
  - 支持中英文
  - 适合对话和文本生成

### 嵌入模型
- **模型名称**: `BAAI/bge-large-zh-v1.5`
- **提供商**: 北京智源人工智能研究院
- **特点**:
  - 专为中文优化
  - 向量维度: 1024
  - 适合语义检索和RAG应用

---

## 💰 定价说明

### 硅基流动定价（参考）

| 模型类型 | 模型名称 | 价格 |
|---------|---------|------|
| LLM | Qwen/Qwen2-VL-7B-Instruct | 查看官网最新价格 |
| Embedding | BAAI/bge-large-zh-v1.5 | 查看官网最新价格 |

**💡 提示：**
- 新用户通常有免费额度
- 具体价格请访问：https://siliconflow.cn/pricing
- 可在控制台查看用量统计

---

## 🔍 API端点信息

本项目使用的API配置：

- **Base URL**: `https://api.siliconflow.cn/v1`
- **API格式**: OpenAI兼容接口
- **认证方式**: Bearer Token (API Key)

---

## ⚠️ 常见问题

### Q1: API调用失败，提示401错误？
**A:** 
- 检查 `.env` 文件中的 `SILICONFLOW_API_KEY` 是否正确
- 确认密钥前缀是 `sk-`
- 检查密钥是否过期

### Q2: API调用失败，提示429错误？
**A:** 
- 请求频率过高，触发了限流
- 检查账户余额或免费额度是否用完
- 等待一段时间后再试

### Q3: 模型名称错误？
**A:** 
硅基流动支持的模型名称格式为：`提供商/模型名`
- ✅ 正确：`Qwen/Qwen2-VL-7B-Instruct`
- ❌ 错误：`Qwen2-VL-7B-Instruct`

### Q4: 想使用其他模型怎么办？
**A:** 
可以修改 `src/agents.py` 中的模型名称：

```python
# LLM模型
qwen_llm = ChatOpenAI(
    model="其他模型名称",  # 例如：Qwen/Qwen2-72B-Instruct
    temperature=0.1,
    openai_api_key=os.getenv("SILICONFLOW_API_KEY"),
    openai_api_base="https://api.siliconflow.cn/v1"
)

# 嵌入模型
embeddings = OpenAIEmbeddings(
    model="其他嵌入模型",  # 例如：BAAI/bge-base-zh-v1.5
    openai_api_key=os.getenv("SILICONFLOW_API_KEY"),
    openai_api_base="https://api.siliconflow.cn/v1"
)
```

### Q5: 如何查看可用模型列表？
**A:** 
访问硅基流动控制台的"模型市场"或查看官方文档：
- https://docs.siliconflow.cn/

---

## 🎛️ 高级配置

### 调整模型参数

在 `src/agents.py` 中可以调整模型参数：

```python
qwen_llm = ChatOpenAI(
    model="Qwen/Qwen2-VL-7B-Instruct",
    temperature=0.1,        # 控制创造性，范围0-1
    max_tokens=2000,        # 最大生成长度
    top_p=0.9,             # 核采样参数
    openai_api_key=os.getenv("SILICONFLOW_API_KEY"),
    openai_api_base="https://api.siliconflow.cn/v1"
)
```

### 切换到更大的模型

如果需要更好的效果，可以使用更大的模型：

```python
# 使用72B参数的模型（更强但更慢）
model="Qwen/Qwen2-72B-Instruct"

# 或使用32B的VL模型
model="Qwen/Qwen2-VL-32B-Instruct"
```

---

## 📊 性能对比

| 模型 | 参数量 | 速度 | 效果 | 成本 |
|------|--------|------|------|------|
| Qwen2-VL-7B-Instruct | 7B | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Qwen2-VL-32B-Instruct | 32B | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Qwen2-72B-Instruct | 72B | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |

**推荐：** 对于邮件自动化场景，7B模型已经足够使用。

---

## 🔐 安全建议

1. ✅ **不要**将 `.env` 文件提交到Git仓库
2. ✅ **定期**更换API密钥
3. ✅ **监控**API使用量，避免超额
4. ✅ **限制**密钥权限，只开启必要的功能
5. ✅ 在 `.gitignore` 中添加：
   ```
   .env
   .env.local
   ```

---

## 📞 获取帮助

- **官方文档**: https://docs.siliconflow.cn/
- **控制台**: https://cloud.siliconflow.cn/
- **技术支持**: 查看官网联系方式

---

## ✅ 验证清单

配置完成后，请确认：

- [ ] 已获取硅基流动API密钥
- [ ] `.env` 文件已正确配置
- [ ] 已安装所有依赖（`pip install -r requirements.txt`）
- [ ] 已删除旧的向量数据库
- [ ] 已重新创建向量数据库（`python create_index.py`）
- [ ] 测试RAG链成功返回结果
- [ ] 主程序能正常运行（`python main.py`）

---

## 🎉 完成！

配置完成后，项目将使用硅基流动的API，享受：
- ✨ 国内网络直连，速度更快
- ✨ 通义千问强大的中文能力
- ✨ 灵活的模型选择
- ✨ 透明的定价机制

祝你使用愉快！🚀

